# This file is managed by the 'app-elementary' file bundle and updated automatically when `meltano upgrade` is run.
# To prevent any manual changes from being overwritten, remove the file bundle from `meltano.yml` or disable automatic updates:
#     meltano config --plugin-type=files app-elementary set _update analyze/datasets/elementary/dashboard/doughnuts/tables-health.yml false

version: datasets/v0.2
title: Tables Health
source: Test Results
description: "#dashboard"
metadata: |-
  {
      "label": "doughnut", 
      "related_table": {
        "columns": [
        ], 
        "aggregates": [
            {"name": "pass", "label": "Passed", "description": "Passed"},
            {"name": "fail", "label": "Failed", "description": "Failed"}
        ]
      },
    "palette": [[30, 255, 30],[255, 99, 132]]
  }
visualisation: |-
  {
      "chartjs-chart": {
        "chartType": "doughnut"
      }
  }
query: |-
  SELECT
    count(CASE WHEN status = 0 THEN 1 END) AS pass
    , count(CASE WHEN status = 1 THEN 1 END) AS fail
  FROM (SELECT
    max(CASE WHEN status = 'pass' THEN 0 ELSE 1 END) AS status
  FROM matatika_test_results.elementary_test_results
  WHERE INVOCATION_ID = (SELECT INVOCATION_ID FROM matatika_test_results.elementary_test_results
                        ORDER BY CREATED_AT DESC LIMIT 1)
  AND MODEL_UNIQUE_ID IS NOT NULL
  GROUP BY MODEL_UNIQUE_ID) as t1
