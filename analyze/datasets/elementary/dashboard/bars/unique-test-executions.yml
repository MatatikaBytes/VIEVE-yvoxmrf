# This file is managed by the 'app-elementary' file bundle and updated automatically when `meltano upgrade` is run.
# To prevent any manual changes from being overwritten, remove the file bundle from `meltano.yml` or disable automatic updates:
#     meltano config --plugin-type=files app-elementary set _update analyze/datasets/elementary/dashboard/bars/unique-test-executions.yml false

version: datasets/v0.2
title: Unique Test Executions
source: Test Results
description: "#dashboard"
metadata: |-
  {
    "label": "Unique Test Executions", 
    "related_table": {
      "columns": [
        {"name": "created_at_date", "label": "Date", "description": "Date"}
      ],
      "aggregates": [
        {"name": "unique_tests", "label": "Tests Run", "description": "Tests Run"}
      ]
    },
    "palette": [[30, 255, 30]]
  }
visualisation: |-
  {"chartjs-chart": 
    {"chartType": "bar", 
      "options": {
        "scales": {
          "y": {
            "beginAtZero": true
          }
        }
      }
    }
  }
query: |-
  SELECT
      DATE_TRUNC(DATE(created_at), DAY) AS created_at_date
      , COUNT(DISTINCT TEST_NAME) AS unique_tests
  FROM matatika_test_results.elementary_test_results
  WHERE DATE(created_at) >= DATE_SUB(CURRENT_DATE(), INTERVAL 6 DAY)
  GROUP BY created_at_date
  ORDER BY created_at_date
